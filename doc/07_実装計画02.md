# 🚀 Tadakan 実装計画書 ver.0.2 - フルGUI版

## 1. フルGUI開発フェーズ概要

### Phase 1: フルGUI基盤構築 (優先度: 最高)
- プリセットID（B63EF9形式）システムの実装
- ストック型バッチファイル運用の実現
- 統合GUI（ホーム画面）の開発
- ドラッグ&ドロップ機能の実装

### Phase 2: 拡張機能実装 (優先度: 高)  
- フィルタリング機能の追加
- プリセット管理ウィザードの実装
- 履歴・サジェスト機能の追加
- エラーハンドリング・ログ機能の強化

### Phase 3: パフォーマンス・品質向上 (優先度: 中)
- 大量ファイル処理の最適化
- バリデーション機能の強化
- 非同期処理の導入
- 統合テストとデバッグ機能の充実

## 2. フルGUIアーキテクチャ設計

### 2.1 プロジェクト構造の拡張
```
src/
├── main.py                    # [改修] GUI起動・CLI統合
├── models/                    # [拡張] プリセットIDシステム追加
│   ├── preset.py             # [改修] B63EF9形式ID・バッチ名対応
│   ├── file_item.py          # [改修] 連番サフィックス対応
│   ├── batch_file.py         # [新規] ストック型バッチファイル管理
│   └── workspace.py          # [新規] 作業用フォルダ管理
├── services/                  # [拡張] フルGUI対応サービス
│   ├── preset_manager.py     # [改修] GUI統合・プリセットID対応
│   ├── file_renamer.py       # [改修] ドラッグ&ドロップ対応
│   ├── batch_generator.py    # [改修] ストック型バッチ生成
│   ├── batch_manager.py      # [新規] バッチファイル管理サービス
│   ├── filter_service.py     # [新規] フィルタリング機能
│   └── workspace_manager.py  # [新規] 作業フォルダ管理
├── gui/                       # [新規] フルGUIインターフェース
│   ├── main_window.py        # メインウィンドウ（統合GUI）
│   ├── preset_panel.py       # プリセット管理パネル
│   ├── input_form.py         # 動的入力フォーム
│   ├── batch_panel.py        # バッチファイル管理パネル
│   ├── drop_zone.py          # ドラッグ&ドロップエリア
│   ├── filter_panel.py       # フィルタリングパネル
│   ├── preset_wizard.py      # プリセット作成ウィザード
│   └── components/           # 再利用可能UIコンポーネント
│       ├── file_list.py      # ファイル一覧表示
│       ├── progress_bar.py   # 進捗表示
│       └── notification.py   # 通知・エラー表示
├── utils/                     # [拡張] GUI対応ユーティリティ
│   ├── id_generator.py       # [新規] B63EF9形式ID生成
│   ├── file_handler.py       # [改修] ドラッグ&ドロップ対応
│   ├── path_manager.py       # [新規] 日本語パス管理
│   └── logger.py             # [改修] GUI用ログ表示
└── config/                    # [拡張] GUI設定管理
    ├── gui_config.py         # [新規] GUI設定管理
    ├── workspace_config.py   # [新規] 作業フォルダ設定
    └── app_settings.py       # [改修] 統合設定管理
```

### 2.2 新規技術要素
- **非同期処理**: `asyncio` + `threading` による並列処理
- **プログレスバー**: `tqdm` または独自実装による進捗表示
- **設定管理**: 階層化設定とバージョン管理
- **ログ管理**: `logging` モジュールの活用強化

## 3. Phase 1: フルGUI基盤構築

### 3.1 プリセットIDシステム (`models/preset.py`)
```python
class Preset:
    """プリセットID対応プリセットクラス"""
    
    def __init__(self, name: str, fields: List[PresetField]):
        self.id = generate_preset_id()  # B63EF9形式
        self.name = name
        self.fields = fields
        self.target_extensions = []  # 対象拡張子
        
    def generate_batch_filename(self, values: Dict[str, str]) -> str:
        """バッチファイル名生成: ID_陣営_キャラ名.bat"""
        
    def generate_file_pattern(self) -> str:
        """ファイル名パターン生成: ID_陣営_キャラ名_A00001.ext"""
```

### 3.2 ストック型バッチ管理 (`services/batch_manager.py`)
```python
class BatchManager:
    """ストック型バッチファイル管理"""
    
    def create_batch_file(self, preset: Preset, values: Dict[str, str]) -> BatchFile:
        """バッチファイル生成と保存"""
        
    def load_batch_files(self, workspace_path: str) -> List[BatchFile]:
        """バッチファイル一覧読み込み"""
        
    def execute_batch_with_files(self, batch_file: BatchFile, 
                                file_paths: List[str]) -> ExecutionResult:
        """ドラッグ&ドロップファイルでのバッチ実行"""
        
    def get_next_sequence_number(self, batch_file: BatchFile) -> str:
        """次の連番（A00001形式）取得"""
```

### 3.3 統合GUIメインウィンドウ (`gui/main_window.py`)
```python
class MainWindow:
    """Tadakanメインウィンドウ"""
    
    def __init__(self):
        self.setup_ui()
        self.preset_panel = PresetPanel()
        self.input_form = DynamicInputForm()
        self.batch_panel = BatchPanel()
        self.drop_zone = DropZone()
        
    def setup_ui(self):
        """UI配置とレイアウト設定"""
        # プリセット管理パネル
        # 入力フォームエリア
        # バッチファイル管理エリア
        # ドラッグ&ドロップエリア
        # 作業フォルダ設定エリア
        
    def on_preset_selected(self, preset: Preset):
        """プリセット選択時の動的フォーム更新"""
        
    def on_files_dropped(self, file_paths: List[str]):
        """ファイルドロップ時の処理"""
```

### 3.4 ドラッグ&ドロップ機能 (`gui/drop_zone.py`)
```python
class DropZone:
    """ドラッグ&ドロップ対応エリア"""
    
    def __init__(self, parent):
        self.setup_drop_area()
        self.selected_batch = None
        
    def handle_file_drop(self, file_paths: List[str]):
        """ファイルドロップ処理"""
        # 拡張子フィルタリング
        # フォルダ内ファイル展開
        # バッチファイル実行
        
    def handle_folder_drop(self, folder_path: str):
        """フォルダドロップ処理"""
        # 再帰的ファイル収集
        # 対象拡張子フィルタ適用
        
    def show_drop_preview(self, items: List[str]):
        """ドロップ予定アイテムプレビュー"""
```

## 4. Phase 2: 拡張機能実装

### 4.1 フィルタリング機能 (`services/filter_service.py`)
```python
class FilterService:
    """フィルタリング機能"""
    
    def filter_files_by_preset_values(self, files: List[FileItem], 
                                     conditions: Dict[str, str]) -> List[FileItem]:
        """プリセット項目による絞り込み"""
        
    def move_to_display_folder(self, files: List[FileItem], 
                              workspace_path: str) -> MoveResult:
        """displayフォルダへの一時移動"""
        
    def restore_from_display_folder(self, workspace_path: str) -> MoveResult:
        """displayフォルダからの復元"""
        
    def create_filter_batch(self, conditions: Dict[str, str]) -> str:
        """フィルタ用バッチファイル生成"""
```

### 4.2 プリセット作成ウィザード (`gui/preset_wizard.py`)
```python
class PresetWizard:
    """プリセット作成ウィザード"""
    
    def show_basic_info_page(self) -> Dict[str, str]:
        """基本情報入力ページ"""
        # プリセット名、説明文入力
        
    def show_field_definition_page(self) -> List[PresetField]:
        """フィールド定義ページ"""
        # 項目追加・編集・順番変更
        # デフォルト値・必須/任意設定
        
    def show_extension_selection_page(self) -> List[str]:
        """対象拡張子選択ページ"""
        # png, mp3, txt等の選択
        
    def show_preview_page(self, preset: Preset) -> bool:
        """プレビュー確認ページ"""
        # サンプルファイル名生成・確認
```

### 4.3 履歴・サジェスト機能 (`services/history_manager.py`)
```python
class HistoryManager:
    """履歴管理とサジェスト機能"""
    
    def record_input_value(self, preset_id: str, field_name: str, value: str):
        """入力値の履歴記録"""
        
    def get_suggestions(self, preset_id: str, field_name: str, 
                       partial_input: str) -> List[str]:
        """入力サジェストの取得"""
        
    def get_recent_values(self, preset_id: str, field_name: str, 
                         limit: int = 10) -> List[str]:
        """最近の入力値取得"""
        
    def export_history(self, file_path: str):
        """履歴データのエクスポート"""
```

### 4.4 エラーハンドリング・ログ機能 (`utils/logger.py`)
```python
class GUILogger:
    """GUI対応ログ機能"""
    
    def setup_gui_logging(self, log_widget):
        """GUI用ログ表示設定"""
        
    def show_error_dialog(self, error: Exception, context: str):
        """エラーダイアログ表示"""
        
    def show_notification(self, message: str, level: str = 'info'):
        """通知メッセージ表示"""
        
    def log_batch_execution(self, batch_file: str, result: ExecutionResult):
        """バッチ実行ログ記録"""
```

## 5. Phase 3: パフォーマンス・品質向上

### 5.1 大量ファイル処理最適化 (`services/bulk_processor.py`)
```python
class BulkFileProcessor:
    """大量ファイル処理最適化"""
    
    def process_files_in_chunks(self, files: List[FileItem], 
                               chunk_size: int = 100,
                               progress_callback: Callable = None):
        """チャンク単位での処理"""
        
    def estimate_processing_time(self, file_count: int) -> float:
        """処理時間推定"""
        
    def show_progress_dialog(self, total_files: int) -> ProgressDialog:
        """進捗ダイアログ表示"""
```

### 5.2 バリデーション機能強化 (`services/validator.py`)
```python
class ValidationService:
    """統合バリデーション機能"""
    
    def validate_preset(self, preset: Preset) -> ValidationResult:
        """プリセット総合バリデーション"""
        # プリセットID重複チェック
        # フィールド定義妥当性チェック
        # 命名パターン構文チェック
        
    def validate_file_operation(self, files: List[str], 
                               batch_file: BatchFile) -> ValidationResult:
        """ファイル操作事前検証"""
        # ファイルアクセス権限チェック
        # ディスク容量チェック
        # パス長制限チェック
        # 日本語文字エンコーディングチェック
```

### 5.3 非同期処理導入 (`utils/async_processor.py`)
```python
class AsyncProcessor:
    """非同期処理基盤"""
    
    def run_async_task(self, task: Callable, 
                      progress_callback: Callable = None):
        """非同期タスク実行"""
        
    def process_files_async(self, files: List[FileItem], 
                           batch_file: BatchFile):
        """ファイル処理の非同期実行"""
        
    def update_gui_from_thread(self, callback: Callable, data: Any):
        """スレッドからのGUI更新"""
```

### 5.4 統合テスト・デバッグ機能 (`test/gui/`)
```python
class GUITestSuite:
    """GUI機能統合テスト"""
    
    def test_preset_creation_workflow(self):
        """プリセット作成ワークフローテスト"""
        
    def test_batch_generation_and_execution(self):
        """バッチ生成・実行テスト"""
        
    def test_drag_drop_functionality(self):
        """ドラッグ&ドロップ機能テスト"""
        
    def test_filter_operations(self):
        """フィルタリング操作テスト"""
        
class DebugPanel:
    """デバッグ機能パネル"""
    
    def show_preset_debug_info(self, preset: Preset):
        """プリセットデバッグ情報表示"""
        
    def show_batch_execution_log(self, batch_file: BatchFile):
        """バッチ実行ログ表示"""
        
    def export_debug_report(self, file_path: str):
        """デバッグレポート出力"""
```

## 6. 実装スケジュールと優先順位

### Sprint 1 (2週間): フルGUI基盤構築
- [ ] プリセットIDシステム（B63EF9形式）の実装
- [ ] ストック型バッチファイル管理の実装
- [ ] 統合GUIメインウィンドウの開発
- [ ] 基本ドラッグ&ドロップ機能の実装
- [ ] 作業フォルダ管理機能の実装

### Sprint 2 (2週間): 動的UI・プリセット管理
- [ ] 動的入力フォーム生成機能
- [ ] プリセット管理パネルの実装
- [ ] バッチファイル管理パネルの実装
- [ ] ファイル連番処理（A00001形式）の実装
- [ ] 日本語パス対応の強化

### Sprint 3 (2週間): 拡張機能実装
- [ ] フィルタリング機能の実装
- [ ] プリセット作成ウィザードの実装
- [ ] 履歴・サジェスト機能の実装
- [ ] エラーハンドリング・ログ機能の強化
- [ ] 通知・進捗表示機能の実装

### Sprint 4 (1週間): 最適化・統合テスト
- [ ] 大量ファイル処理の最適化
- [ ] バリデーション機能の統合
- [ ] 非同期処理の導入
- [ ] 統合テスト・デバッグ機能の実装
- [ ] ドキュメント更新・リリース準備

## 7. テスト戦略

### 7.1 GUI機能テスト
```python
# GUI統合テスト
def test_preset_id_generation():
    """B63EF9形式プリセットID生成テスト"""
    
def test_batch_file_stock_management():
    """ストック型バッチファイル管理テスト"""
    
def test_dynamic_form_generation():
    """動的フォーム生成テスト"""
    
def test_drag_drop_workflow():
    """ドラッグ&ドロップワークフローテスト"""
    
def test_filter_functionality():
    """フィルタリング機能テスト"""
    
def test_japanese_path_handling():
    """日本語パス処理テスト"""
```

### 7.2 品質ゲート
- GUI機能テストカバレッジ: 80%以上
- プリセットID生成の一意性: 100%
- ドラッグ&ドロップ成功率: 95%以上
- 日本語パス処理成功率: 100%
- 1000ファイル処理時間: 60秒以内

## 8. リスク対策と回避戦略

### 8.1 GUI実装リスク対策
- **レスポンス性**: 非同期処理によるUI凍結防止
- **ドラッグ&ドロップ**: 複数プラットフォーム対応のテスト強化
- **動的UI**: プリセット変更時のフォーム更新エラー対策

### 8.2 運用リスク対策
- **バッチファイル管理**: ストック数制限とクリーンアップ機能
- **日本語対応**: Shift_JIS エンコーディング問題の回避
- **プリセットID**: 重複チェックと再生成機能の実装

## 9.デプロイメント戦略

### 9.1 段階的リリース
1. **アルファ版**: フルGUI基盤のみ（Phase 1完了後）
2. **ベータ版**: 拡張機能含む（Phase 2完了後）  
3. **正式版**: 最適化・統合テスト完了（Phase 3完了後）

### 9.2 既存ユーザー移行
- CLI版からの段階的移行支援
- 既存プリセットの自動変換機能
- GUI版とCLI版の並行利用期間設定

### 9.3 パッケージング
- Windows向け実行ファイル（.exe）の作成
- 必要ライブラリの同梱
- インストーラーの作成

---

*この実装計画書v0.2は、AI会議とClaude Codeワークフローを踏まえたフルGUI版開発計画です*